---
layout: post
title: 《图数据库》
category: 读书
keywords: 每月一本书
tag: 读书
---
![img](https://img1.doubanio.com/view/subject/l/public/s28017088.jpg)

最近对一个旧项目进行改造，将原本存储在HBASE中的数据，重新导到Neo4j图数据库中，期间翻看了本介绍Neo4j的书——[《图数据库》](https://github.com/bruceFend/brucefend.github.io/blob/master/public/img/neo4j-1.jpg)。

这本书以Neo4j数据库为例，对比了图数据库和关系型数据库及其他类型的NoSQL数据库的一些特点，其介绍建模方式和实际例子的部分是干货内容，案例中cypher的语句可以作为不错的学习资料。 

#### 运行模式
*4.2.1嵌入式与服务器*  部分介绍了Neo4j的两种运行模式：嵌入式和服务器模式，笔者目前采用的是服务器模式，且只有单节点，后期会根据数据量、响应速度等情况进行扩展，因此*4.2.2集群* 和 *4.2.3负载均衡* 部分只是简单浏览了一遍。

#### 存储
*6.2 原生图存储* 介绍了很重要的一点：
> Neo4j将图数据存储在若干不同的存储文件中，每个文件包含图的特定部分的数据（例如：节点、联系、属性）。  
> 存储职责的划分——特别是图结构与属性数据的分离——促进了高性能的图遍历。

其中：
- 节点存储在neostore.nodestore.db，每个记录长度固定为9个字节，目的在于快速查找文件中的节点（ O(1) ）。
- 联系存储在neostore.relationshipstore.db，每个记录长度固定为33个字节。
- 属性存储在neostore.propertystore.db中。一个属性记录包含**属性类型**和**属性索引文件**(neostore.propertystore.db.index，存储属性名称)

属性索引文件是个有趣的设计，通过这个文件可以实现**属性名称的共享**，即相同的属性名称只会存一份，可以节省相当大的空间和I/O开销。而在笔者之前接触的数据库如HBase，就没有发现类似的设计，因此HBase表推荐列簇名的长度要尽可能短。


*6.4 非功能型特性* 中介绍了包括事务、可恢**复性**、**高可用性**和**可扩展性**，还有第七章图论部分的内容，都只是简单看了一遍，等后期用得多了再深入学习。

---

在接触图数据库之前，笔者有时候会思考诸如推荐系统如果用MySQL的话应该怎么实现。比如QQ好友，假设就只有一张“用户表”和一张“好友关系表”，用户A、B、C的关系如下：A和C是好友，B和C也是好友。 

判断A和B是否是好友关系的做法很简单，在“好友关系表”中查找是否存在“A-B”或者“B-A”的记录即可；要给A推荐B也不是太麻烦，拿到A的好友集与B的好友集的交集，即可得到他们有多少个共同的好友，然后就可以推荐。 

在只考虑一层关系的情况下，关系型数据库和图数据库的速度应该差距不大，但当考虑的关系层级更深的时候，差距会比较明显[^1]，毕竟在这类场景中，图数据库有天然的优势。

深度 | 关系型数据库的执行时间(s) | Neo4j的执行时间(s) | 返回的记录条数
---|---|---|---
2 | 0.016 | 0.01 | ~2500
3 | 30.267 | 0.168 | ~110 000
4 | 1543.505 | 1.359 | ~600 000
5 | 未完成 | 2.132 | ~800 000



关于查询延迟问题，在书中 *6.4.4 可扩展性* 有提到：
> 图数据库没有和传统关系型数据库同样的延迟问题，图数据库的性能并不取决于数据集的总规模，而只取决于被查询到的数据。

这一点会在近期进行实验验证。


扩展阅读
---
英文版电子书：[Graph_Databases](http://na-sjl.marketo.com/rs/neotechnology/images/Graph_Databases_2e_Neo4j.pdf)  
[图数据库及其在恒昌的应用简介](https://zhuanlan.zhihu.com/p/28968572)  
[大话数据结构——图](https://www.cnblogs.com/w-wanglei/p/figure.html)  
[浅析数据结构-图的基本概念](https://www.cnblogs.com/polly333/p/4760275.html)  
[图论系列博客](https://blog.csdn.net/saltriver/article/category/6506969)

[^1]: > [图数据库——大数据时代的高铁](https://blog.csdn.net/heyc861221/article/details/80128421) 
